package com.sportchamps.worldbankstats.model

import android.util.Log
import com.google.gson.Gson
import com.sportchamps.worldbankstats.common.util.AppConstants
import com.sportchamps.worldbankstats.common.util.CommonUtil
import com.sportchamps.worldbankstats.model.data.pojo.PageHeader
import com.sportchamps.worldbankstats.model.data.pojo.worldgdp.WorldGdp
import com.sportchamps.worldbankstats.model.rest.WorldBankRestApi
import org.junit.Before

import org.junit.Assert.*
import org.junit.Test

class NetworkRepositoryTest {
    var networkDataJson:StringBuffer = StringBuffer("""[{"page":1,"pages":4,"per_page":50,"lastupdated":"2018-08-28","total":21},[{"indicator":{"id":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1980","value":270,"unit":"","obs_status":"","decimal":0},{"indicator":{"id":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1979","value":220,"unit":"","obs_status":"","decimal":0},{"indicator":{"id":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1978","value":200,"unit":"","obs_status":"","decimal":0},{"indicator":{"id":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1977","value":180,"unit":"","obs_status":"","decimal":0},{"indicator":{"id":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1976","value":180,"unit":"","obs_status":"","decimal":0},{"indicator":{"id":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1975","value":190,"unit":"","obs_status":"","decimal":0},{"indicator":{"id":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1974","value":170,"unit":"","obs_status":"","decimal":0},{"indicator":{"id":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1973","value":140,"unit":"","obs_status":"","decimal":0},{"indicator":{"id":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1972","value":120,"unit":"","obs_status":"","decimal":0},{"indicator":{"id":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1971","value":120,"unit":"","obs_status":"","decimal":0},{"indicator":{"id":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1970","value":110,"unit":"","obs_status":"","decimal":0},{"indicator":{"id":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1969","value":110,"unit":"","obs_status":"","decimal":0},{"indicator":{"id":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1968","value":100,"unit":"","obs_status":"","decimal":0},{"indicator":{"id":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1967","value":100,"unit":"","obs_status":"","decimal":0},{"indicator":{"id":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1966","value":100,"unit":"","obs_status":"","decimal":0},{"indicator":{"id":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1965","value":110,"unit":"","obs_status":"","decimal":0},{"indicator":{"id":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1964","value":110,"unit":"","obs_status":"","decimal":0},{"indicator":{"id":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1963","value":90,"unit":"","obs_status":"","decimal":0},{"indicator":{"id":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1962","value":90,"unit":"","obs_status":"","decimal":0},{"indicator":{"id":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1961","value":null,"unit":"","obs_status":"","decimal":0},{"indicator":{"id":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1960","value":null,"unit":"","obs_status":"","decimal":0}]]""")
    var networkDataWrongJson:StringBuffer = StringBuffer("""[{"page":1,"pages":2,"per_page":50,"lastupdated":"2018-08-28","total":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1980","value":270,"unit":"","obs_status":"","decimal":0},{"indicator":{"id":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1979","value":220,"unit":"","obs_status":"","decimal":0},{"indicator":{"id":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1978","value":200,"unit":"","obs_status":"","decimal":0},{"indicator":{"id":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1977","value":180,"unit":"","obs_status":"","decimal":0},{"indicator":{"id":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1976","value":180,"unit":"","obs_status":"","decimal":0},{"indicator":{"id":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1975","value":190,"unit":"","obs_status":"","decimal":0},{"indicator":{"id":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1974","value":170,"unit":"","obs_status":"","decimal":0},{"indicator":{"id":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1973","value":140,"unit":"","obs_status":"","decimal":0},{"indicator":{"id":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1972","value":120,"unit":"","obs_status":"","decimal":0},{"indicator":{"id":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1971","value":120,"unit":"","obs_status":"","decimal":0},{"indicator":{"id":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1970","value":110,"unit":"","obs_status":"","decimal":0},{"indicator":{"id":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1969","value":110,"unit":"","obs_status":"","decimal":0},{"indicator":{"id":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1968","value":100,"unit":"","obs_status":"","decimal":0},{"indicator":{"id":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1967","value":100,"unit":"","obs_status":"","decimal":0},{"indicator":{"id":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1966","value":100,"unit":"","obs_status":"","decimal":0},{"indicator":{"id":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1965","value":110,"unit":"","obs_status":"","decimal":0},{"indicator":{"id":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1964","value":110,"unit":"","obs_status":"","decimal":0},{"indicator":{"id":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1963","value":90,"unit":"","obs_status":"","decimal":0},{"indicator":{"id":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1962","value":90,"unit":"","obs_status":"","decimal":0},{"indicator":{"id":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1961","value":null,"unit":"","obs_status":"","decimal":0},{"indicator":{"id":"NY.GNP.PCAP.CD","value":"GNI per capita, Atlas method (current US${'$'})"},"country":{"id":"IN","value":"India"},"countryiso3code":"IND","date":"1960","value":null,"unit":"","obs_status":"","decimal":0}]]""")
    var fixedJsonGdpData:StringBuffer = StringBuffer("""{"countriesGdpData":[{"id":"IND","iso2Code":"IN","name":"India","region":{"id":"SAS","iso2code":"8S","value":"South Asia"},"adminregion":{"id":"SAS","iso2code":"8S","value":"South Asia"},"incomeLevel":{"id":"LMC","iso2code":"XN","value":"Lower middle income"},"lendingType":{"id":"IBD","iso2code":"XF","value":"IBRD"},"capitalCity":"New Delhi","longitude":"77.225","latitude":"28.6353"}]}""")
    @Before
    fun setUp() {
    }

    @Test
    fun test_getNetworkPageCount_GdpData_correctJson(){
        val type = AppConstants.Companion.OBJECT_TYPE.GDP
        var bufferString = StringBuffer(networkDataJson)
        var pageCount = 0
        val expectedPageCount = "4"

        val responseStringBuf:StringBuffer =  bufferString.append(networkDataJson,
                0,1000)
        val pageHeader = CommonUtil.getPageHeader(responseStringBuf)
        if(null != pageHeader)
            pageCount = pageHeader.pages
        assertEquals(expectedPageCount  , pageCount.toString())
    }

    @Test
    fun test_getNetworkPageCount_GdpData_WrongJson(){
        val type = AppConstants.Companion.OBJECT_TYPE.GDP
        var bufferString = StringBuffer(networkDataWrongJson)
        var pageCount = 0
        val expectedPageCount = "2"

        val responseStringBuf:StringBuffer =  bufferString.append(networkDataJson,
                0,1000)
        val pageHeader = CommonUtil.getPageHeader(responseStringBuf)
        if(null != pageHeader)
            pageCount = pageHeader.pages
        assertNotEquals(expectedPageCount  , pageCount.toString())
    }
}